<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jagdrevier Website - Diagnose</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .status {
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 5px solid;
        }
        .success {
            background-color: #d4edda;
            border-color: #28a745;
            color: #155724;
        }
        .error {
            background-color: #f8d7da;
            border-color: #dc3545;
            color: #721c24;
        }
        .info {
            background-color: #d1ecf1;
            border-color: #17a2b8;
            color: #0c5460;
        }
        .loading {
            background-color: #fff3cd;
            border-color: #ffc107;
            color: #856404;
        }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 3px;
            overflow-x: auto;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <h1>ü¶å Jagdrevier Website - Diagnose</h1>
    
    <div id="status-container">
        <div class="status loading">
            <strong>üîÑ Lade Diagnose...</strong>
            <p>√úberpr√ºfe Website-Komponenten...</p>
        </div>
    </div>

    <div style="margin: 20px 0;">
        <button onclick="runDiagnosis()">üîç Diagnose erneut ausf√ºhren</button>
        <button onclick="loadMainSite()">üè† Zur Hauptseite</button>
        <button onclick="testSupabase()">üóÑÔ∏è Supabase testen</button>
    </div>

    <div id="details" style="display: none;">
        <h3>üìã Technische Details:</h3>
        <pre id="tech-details"></pre>
    </div>

    <script>
        let diagnosisResults = [];

        function addStatus(type, title, message, details = null) {
            const container = document.getElementById('status-container');
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.innerHTML = `<strong>${title}</strong><p>${message}</p>`;
            container.appendChild(div);
            
            diagnosisResults.push({ type, title, message, details });
            
            if (details) {
                updateTechDetails();
            }
        }

        function clearStatus() {
            document.getElementById('status-container').innerHTML = '';
            diagnosisResults = [];
        }

        function updateTechDetails() {
            const detailsDiv = document.getElementById('details');
            const techDetails = document.getElementById('tech-details');
            
            let output = '';
            diagnosisResults.forEach(result => {
                if (result.details) {
                    output += `${result.title}:\n${JSON.stringify(result.details, null, 2)}\n\n`;
                }
            });
            
            if (output) {
                techDetails.textContent = output;
                detailsDiv.style.display = 'block';
            }
        }

        async function runDiagnosis() {
            clearStatus();
            addStatus('loading', 'üîÑ Starte Diagnose', '√úberpr√ºfe Website-Komponenten...');

            // 1. Browser-Kompatibilit√§t
            try {
                const browserInfo = {
                    userAgent: navigator.userAgent,
                    language: navigator.language,
                    cookieEnabled: navigator.cookieEnabled,
                    onLine: navigator.onLine
                };
                addStatus('success', '‚úÖ Browser-Check', 'Browser ist kompatibel', browserInfo);
            } catch (error) {
                addStatus('error', '‚ùå Browser-Check', `Browser-Fehler: ${error.message}`, error);
            }

            // 2. JavaScript-Funktionalit√§t
            try {
                const jsTest = {
                    es6Support: typeof Promise !== 'undefined',
                    fetchSupport: typeof fetch !== 'undefined',
                    localStorageSupport: typeof localStorage !== 'undefined'
                };
                
                if (jsTest.es6Support && jsTest.fetchSupport) {
                    addStatus('success', '‚úÖ JavaScript-Check', 'Alle erforderlichen JS-Features verf√ºgbar', jsTest);
                } else {
                    addStatus('error', '‚ùå JavaScript-Check', 'Fehlende JS-Features', jsTest);
                }
            } catch (error) {
                addStatus('error', '‚ùå JavaScript-Check', `JS-Fehler: ${error.message}`, error);
            }

            // 3. Netzwerk-Verbindung
            try {
                const response = await fetch(window.location.origin + '/favicon.ico');
                if (response.ok) {
                    addStatus('success', '‚úÖ Netzwerk-Check', 'Verbindung zum Server erfolgreich');
                } else {
                    addStatus('error', '‚ùå Netzwerk-Check', `Server-Antwort: ${response.status}`);
                }
            } catch (error) {
                addStatus('error', '‚ùå Netzwerk-Check', `Netzwerk-Fehler: ${error.message}`, error);
            }

            // 4. Supabase-Verbindung
            await testSupabaseConnection();

            // 5. React-App Test
            try {
                const reactDiv = document.getElementById('root');
                if (reactDiv) {
                    addStatus('info', 'üì¶ React-Container', 'React-Container gefunden - App sollte laden');
                } else {
                    addStatus('error', '‚ùå React-Container', 'React-Container (#root) nicht gefunden');
                }
            } catch (error) {
                addStatus('error', '‚ùå React-Check', `React-Fehler: ${error.message}`, error);
            }

            // 6. Console-Fehler pr√ºfen
            const errors = [];
            const originalError = console.error;
            console.error = function(...args) {
                errors.push(args.join(' '));
                originalError.apply(console, args);
            };

            setTimeout(() => {
                if (errors.length > 0) {
                    addStatus('error', '‚ùå Console-Fehler', `${errors.length} Fehler gefunden`, errors);
                } else {
                    addStatus('success', '‚úÖ Console-Check', 'Keine Console-Fehler gefunden');
                }
                console.error = originalError;
            }, 2000);
        }

        async function testSupabaseConnection() {
            try {
                const supabaseUrl = 'https://whqbrtrbzulmifmrzchu.supabase.co';
                const response = await fetch(supabaseUrl + '/rest/v1/', {
                    headers: {
                        'apikey': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndocWJydHJienVsbWlmbXJ6Y2h1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA5OTQ4ODYsImV4cCI6MjA3NjU3MDg4Nn0.o34zBENNSVEM-atUKzPf0j7LXkaLCdvRgZt98aE2H00'
                    }
                });
                
                if (response.ok) {
                    addStatus('success', '‚úÖ Supabase-Check', 'Supabase-Verbindung erfolgreich');
                } else {
                    addStatus('error', '‚ùå Supabase-Check', `Supabase-Fehler: ${response.status}`);
                }
            } catch (error) {
                addStatus('error', '‚ùå Supabase-Check', `Supabase-Verbindungsfehler: ${error.message}`, error);
            }
        }

        async function testSupabase() {
            addStatus('loading', 'üîÑ Supabase-Test', 'Teste Supabase-Funktionalit√§t...');
            await testSupabaseConnection();
        }

        function loadMainSite() {
            window.location.href = '/';
        }

        // Automatische Diagnose beim Laden
        document.addEventListener('DOMContentLoaded', runDiagnosis);
    </script>
</body>
</html>